# è‚¡ç¥¨å…¬å‘Šä¿¡æ¯APIæœåŠ¡ - å¼€å‘ä»»åŠ¡æ¸…å•

## é¡¹ç›®æ¦‚è¿°
åŸºäº FastAPI + AKShare å¼€å‘çš„è‚¡ç¥¨å…¬å‘Šä¿¡æ¯APIæœåŠ¡ï¼Œä¸“æ³¨äºæä¾›Aè‚¡å¸‚åœºçš„å…¬å‘Šæ•°æ®æŸ¥è¯¢å’ŒAIæ™ºèƒ½æ€»ç»“åŠŸèƒ½ã€‚

## ä»»åŠ¡çŠ¶æ€è¯´æ˜
- âœ… å·²å®Œæˆ
- ğŸš§ è¿›è¡Œä¸­
- âŒ å¾…å¼€å‘
- ğŸ”„ éœ€è¦é‡æ„

---

## ä»»åŠ¡1: è·å–è‚¡ç¥¨å…¬å‘Šåˆ—è¡¨API

**æ¥å£**: `GET /api/v1/announcements/{stock_code}`

### ğŸ“‹ éœ€æ±‚æè¿°
- è·å–å•ä¸ªè‚¡ç¥¨è¿‡å»10å¤©çš„å…¬å‘Šä¿¡æ¯
- ä½¿ç”¨ AKShare çš„ `stock_notice_report` æ¥å£
- è¿”å›å®Œæ•´çš„å…¬å‘Šå¯¹è±¡åˆ—è¡¨ï¼ˆä¸è·å–æ­£æ–‡å†…å®¹ï¼‰

### ğŸ¯ æœŸæœ›åŠŸèƒ½
- è¾“å…¥ï¼šè‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000001ï¼‰
- è¾“å‡ºï¼šå…¬å‘ŠåŸºæœ¬ä¿¡æ¯åˆ—è¡¨ï¼ˆæ ‡é¢˜ã€ç±»åˆ«ã€æ—¥æœŸã€é“¾æ¥ç­‰ï¼‰
- æ—¶é—´èŒƒå›´ï¼šè¿‡å»10å¤©
- æ•°æ®æºï¼šå·¨æ½®èµ„è®¯ç½‘ï¼ˆé€šè¿‡AKShareï¼‰

### ğŸ“¤ å“åº”æ ¼å¼
```json
{
    "success": true,
    "data": {
        "announcements": [
            {
                "stock_code": "000001",
                "stock_name": "å¹³å®‰é“¶è¡Œ",
                "title": "å…³äºå¬å¼€2024å¹´ç¬¬ä¸‰æ¬¡ä¸´æ—¶è‚¡ä¸œå¤§ä¼šçš„é€šçŸ¥",
                "category": "ä¸´æ—¶è‚¡ä¸œå¤§ä¼š",
                "publish_date": "2024-09-17",
                "url": "http://static.cninfo.com.cn/finalpage/..."
            }
        ],
        "total": 1,
        "page": 1,
        "size": 20
    },
    "message": "è·å–å…¬å‘ŠæˆåŠŸ"
}
```

### ğŸ’» æŠ€æœ¯å®ç°è¦ç‚¹
- ç§»é™¤ç°æœ‰çš„ `date` å‚æ•°ï¼Œæ”¹ä¸ºè‡ªåŠ¨è·å–è¿‡å»10å¤©
- ä½¿ç”¨ `ak.stock_notice_report(symbol='å…¨éƒ¨', date=æ—¥æœŸ)` å¹¶æŒ‰è‚¡ç¥¨ä»£ç ç­›é€‰
- å¾ªç¯è·å–è¿‡å»10å¤©çš„æ•°æ®å¹¶åˆå¹¶
- **ä»…è¿”å›å…¬å‘ŠåŸºæœ¬ä¿¡æ¯ï¼Œä¸è·å–URLæ­£æ–‡å†…å®¹**

### âš ï¸ æ³¨æ„äº‹é¡¹
- éœ€è¦å¤„ç†AKShareæ¥å£å¯èƒ½çš„å¼‚å¸¸
- æŸäº›æ—¥æœŸå¯èƒ½æ²¡æœ‰å…¬å‘Šæ•°æ®
- éœ€è¦å»é‡å¤„ç†ç›¸åŒçš„å…¬å‘Š

### ğŸ“Š å½“å‰çŠ¶æ€
âœ… **å·²å®Œæˆ** - å·²æ”¯æŒè‡ªåŠ¨è·å–è¿‡å»10å¤©å…¬å‘Šæ•°æ®ï¼Œå»é‡å¤„ç†ï¼Œå¼‚å¸¸å¤„ç†å·²å®ç°

---

## ä»»åŠ¡2: AIæ™ºèƒ½æ€»ç»“å…¬å‘ŠAPI

**æ¥å£**: `POST /api/v1/announcements/{stock_code}/sum`

### ğŸ“‹ éœ€æ±‚æè¿°
- åŸºäºè‚¡ç¥¨ä»£ç è·å–è¿‡å»10å¤©çš„å…¬å‘Šæ•°æ®
- **è®¿é—®æ¯ä¸ªå…¬å‘Šçš„URLé“¾æ¥ï¼Œä¼˜å…ˆé€šè¿‡classä¸ºpdf-linkçš„å…ƒç´ è·å–PDFé“¾æ¥**
- **å¦‚è·å–åˆ°PDFé“¾æ¥ï¼Œåˆ™è®¿é—®è¯¥PDFæ–‡ä»¶ï¼Œæå–PDFæ­£æ–‡å†…å®¹å¹¶è¿”å›ï¼ˆä»…ä¿ç•™å‰Nå­—ï¼ŒNç”±é…ç½®é¡¹ pdf_content_max_chars æ§åˆ¶ï¼Œé»˜è®¤500ï¼‰**
- **å¦‚æœªè·å–åˆ°PDFé“¾æ¥ï¼Œåˆ™å›é€€ä¸ºåŸæœ‰ç½‘é¡µæ­£æ–‡æå–é€»è¾‘**
- ä½¿ç”¨ç™¾ç‚¼å¤§æ¨¡å‹ Qwen3 å¯¹æ¯ä¸ªå…¬å‘Šè¿›è¡Œæ™ºèƒ½æ€»ç»“
- å°†æ‰€æœ‰å…¬å‘Šçš„æ€»ç»“å†æ¬¡æ±‡æ€»ä¸ºæœ€ç»ˆçš„ content

### ğŸ¯ æœŸæœ›åŠŸèƒ½
- è¾“å…¥ï¼šè‚¡ç¥¨ä»£ç 
- å¤„ç†æµç¨‹ï¼š
  1. è°ƒç”¨ä»»åŠ¡1æ–¹æ³•è·å–å…¬å‘Šåˆ—è¡¨
  2. **é€ä¸ªè®¿é—®æ¯ä¸ªå…¬å‘Šçš„URLï¼Œè§£æè·å–æ­£æ–‡å†…å®¹**
  3. å¯¹æ¯ä¸ªå…¬å‘Šæ­£æ–‡è°ƒç”¨LLMæ€»ç»“æˆä¸€å¥è¯
  4. å°†æ‰€æœ‰å•å¥æ€»ç»“å†æ¬¡è°ƒç”¨LLMæ±‡æ€»ä¸ºæœ€ç»ˆcontentï¼ˆ500å­—å†…ï¼‰

### ğŸ“¤ å“åº”æ ¼å¼
```json
{
    "success": true,
    "data": {
        "summary": "ã€AIæ€»ç»“åŠŸèƒ½é¢„ç•™ã€‘é’ˆå¯¹è‚¡ç¥¨ï¼š000001çš„å…¬å‘Šæ€»ç»“",
        "content": "åŸºäºè¯¥è‚¡ç¥¨è¿‡å»10å¤©çš„å…¬å‘Šå†…å®¹æ·±åº¦åˆ†æï¼šå…¬å‘Š1æ€»ç»“å¥+å…¬å‘Š2æ€»ç»“å¥+...ï¼Œç»¼åˆåˆ†æå¾—å‡ºæœ€ç»ˆæŠ•èµ„è§‚ç‚¹å’Œå…³é”®ä¿¡æ¯æ±‡æ€»ã€‚",
        "word_count": 485,
        "model_info": {
            "model": "qwen3",
            "provider": "ç™¾ç‚¼å¤§æ¨¡å‹",
            "status": "æ¥å£é¢„ç•™"
        }
    },
    "message": "AIæ€»ç»“å®Œæˆï¼ˆå½“å‰ä¸ºé¢„ç•™æ¥å£ï¼‰"
}
```

### ğŸ’» æŠ€æœ¯å®ç°è¦ç‚¹
- ä½¿ç”¨ Playwright æ›¿ä»£ BeautifulSoup å¤„ç†åŠ¨æ€æ¸²æŸ“çš„ç½‘é¡µå†…å®¹ã€‚
- åœ¨ `_extract_announcement_content` æ–¹æ³•ä¸­ï¼š
  1. ä½¿ç”¨ Playwright åŠ è½½ç½‘é¡µã€‚
  2. å°è¯•é€šè¿‡ `a.pdf-link` é€‰æ‹©å™¨è·å– PDF é“¾æ¥ã€‚
  3. å¦‚æœæ‰¾åˆ° PDF é“¾æ¥ä¸”ä»¥ `.pdf` ç»“å°¾ï¼Œåˆ™æå– PDF å†…å®¹ï¼Œå¹¶ä»…ä¿ç•™å‰Nå­—ï¼ˆç”±é…ç½®é¡¹ `pdf_content_max_chars` æ§åˆ¶ï¼Œé»˜è®¤500ï¼‰ã€‚
  4. å¦‚æœæœªæ‰¾åˆ° PDF é“¾æ¥ï¼Œåˆ™å›é€€åˆ°æå–ç½‘é¡µæ­£æ–‡å†…å®¹ã€‚
- ç¡®ä¿ Playwright çš„æµè§ˆå™¨å®ä¾‹åœ¨æ“ä½œå®Œæˆåæ­£ç¡®å…³é—­ã€‚

### âš ï¸ æ³¨æ„äº‹é¡¹
- ç¡®ä¿å¼€å‘ç¯å¢ƒä¸­å·²å®‰è£… Playwrightï¼Œå¹¶è¿è¡Œ `playwright install` å®‰è£…æµè§ˆå™¨ä¾èµ–ã€‚
- å¤„ç† Playwright çš„è¶…æ—¶å’Œå¼‚å¸¸æƒ…å†µï¼Œé¿å…å› ç½‘ç»œé—®é¢˜å¯¼è‡´ä»»åŠ¡å¤±è´¥ã€‚
- ç¡®ä¿æå–çš„å†…å®¹ç»è¿‡æ¸…ç†ï¼Œå»é™¤å¤šä½™çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ã€‚
- å¯¹PDFæ­£æ–‡åœ¨æ¸…æ´—åè¿›è¡ŒNå­—æˆªæ–­ï¼ˆç”±é…ç½®é¡¹æ§åˆ¶ï¼‰ï¼Œé¿å…ç©ºç™½å’Œæ¢è¡Œå½±å“è®¡æ•°ã€‚

### ğŸ“Š å½“å‰çŠ¶æ€
âœ… **å·²å®Œæˆ** - å·²å®ç°PDFä¼˜å…ˆè§£æä¸æ¸…æ´—åæŒ‰é…ç½®é•¿åº¦æˆªæ–­ã€ç½‘é¡µæ­£æ–‡å›é€€ã€Playwrightæµç¨‹ä¸èµ„æºé‡Šæ”¾ï¼ŒLLMæ€»ç»“æ±‡æ€»é€»è¾‘å·²æ¥å…¥ï¼ˆæ¥å£ä¿¡æ¯ä¿ç•™ï¼‰ã€‚

---

## ä»»åŠ¡3: é…ç½®åŒ–æ—¶é—´èŒƒå›´ä¸PDFæˆªæ–­é•¿åº¦

**ç›®æ ‡**: å°†ä»»åŠ¡1å’Œä»»åŠ¡2ä¸­çš„â€œè¿‡å»10å¤©â€å’Œâ€œPDFæ­£æ–‡å‰500å­—â€è®¾ç½®ä¸ºå¯é…ç½®å‚æ•°

### ğŸ“‹ éœ€æ±‚æè¿°
- å°†æ—¶é—´èŒƒå›´ä»å›ºå®šçš„â€œè¿‡å»10å¤©â€æ”¹ä¸ºä»é…ç½®æ–‡ä»¶ `config.yaml` ä¸­è¯»å–ã€‚
- æ–°å¢å‚æ•° `announcement_time_range_days`ï¼Œç”¨äºå®šä¹‰æ—¶é—´èŒƒå›´ï¼ˆå•ä½ï¼šå¤©ï¼Œé»˜è®¤10ï¼‰ã€‚
- æ–°å¢å‚æ•° `pdf_content_max_chars`ï¼Œç”¨äºå®šä¹‰PDFæ­£æ–‡æˆªæ–­é•¿åº¦ï¼ˆå•ä½ï¼šå­—ï¼Œé»˜è®¤500ï¼‰ã€‚

### ğŸ¯ æœŸæœ›åŠŸèƒ½
- é…ç½®æ–‡ä»¶è·¯å¾„ï¼š`app/core/config.yaml`
- é…ç½®ç¤ºä¾‹ï¼š
  ```yaml
  announcement_time_range_days: 10
  pdf_content_max_chars: 500
  ```
- ä»»åŠ¡1å’Œä»»åŠ¡2ç›¸å…³é€»è¾‘éœ€æ”¹ä¸ºè¯»å–ä¸Šè¿°é…ç½®å‚æ•°ã€‚

### ğŸ’» æŠ€æœ¯å®ç°è¦ç‚¹
- åœ¨ `config.yaml` ä¸­æ–°å¢ `announcement_time_range_days` ä¸ `pdf_content_max_chars` å‚æ•°ã€‚
- ä¿®æ”¹ `announcement_service.py`ï¼Œè¯»å–ä¸Šè¿°é…ç½®å¹¶åœ¨ç¼ºçœæ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼ˆ10å¤©ã€500å­—ï¼‰ã€‚
- ç¡®ä¿è¯»å–é…ç½®å¤±è´¥æ—¶æœ‰å¥å£®çš„å›é€€ä¸æ—¥å¿—è®°å½•ã€‚

### âš ï¸ æ³¨æ„äº‹é¡¹
- é…ç½®æ–‡ä»¶è¯»å–å¤±è´¥æ—¶éœ€è®°å½•æ—¥å¿—å¹¶ä½¿ç”¨é»˜è®¤å€¼ã€‚
- ä¿®æ”¹åçš„é€»è¾‘éœ€é€šè¿‡å•å…ƒæµ‹è¯•éªŒè¯ã€‚

### ğŸ“Š å½“å‰çŠ¶æ€
âœ… **å·²å®Œæˆ** - å·²å®ç°é…ç½®åŒ–æ—¶é—´èŒƒå›´ä¸PDFæˆªæ–­é•¿åº¦ï¼Œæ”¯æŒ YAML ä¸ç¯å¢ƒå˜é‡è¦†ç›–ï¼Œé»˜è®¤10å¤©ä¸500å­—ã€‚

---

## ä»»åŠ¡4: Dockerfile æ£€æŸ¥ä¸ä¼˜åŒ–

**ç›®æ ‡**: ç¡®ä¿å®¹å™¨ç¯å¢ƒæ»¡è¶³æœ¬é¡¹ç›®è¿è¡Œéœ€æ±‚ï¼ˆFastAPI + AKShare + Playwright + pdfplumberï¼‰ï¼Œå¹¶å…·å¤‡å¥åº·æ£€æŸ¥ä¸é root è¿è¡Œçš„æœ€ä½³å®è·µã€‚

### ğŸ“‹ éœ€æ±‚æè¿°
- éªŒè¯å¹¶å®Œå–„ Dockerfileï¼Œä½¿å…¶åœ¨æ„å»ºä¸è¿è¡Œé˜¶æ®µæ»¡è¶³ï¼š
  - å®‰è£… Playwright åŠå…¶ç³»ç»Ÿä¾èµ–ï¼Œå¹¶åœ¨æ„å»ºé˜¶æ®µæ‰§è¡Œæµè§ˆå™¨å®‰è£…ã€‚
  - æ”¯æŒ pdfplumber æ‰€éœ€ä¾èµ–ï¼ˆå¦‚ Pillow è¿è¡Œä¾èµ–ï¼‰ã€‚
  - å¥åº·æ£€æŸ¥ä¾èµ– curl å·²å®‰è£…å¯ç”¨ã€‚
  - é root ç”¨æˆ·èƒ½æ­£å¸¸è¿è¡Œ Playwrightï¼ˆæµè§ˆå™¨æ–‡ä»¶è·¯å¾„å¯å†™ï¼‰ã€‚
  - æ—¶åŒºã€ç¼–ç åŠä¸­æ–‡å­—ä½“ï¼ˆå¦‚éœ€è¦ï¼‰é…ç½®ã€‚
  - é…ç½®å›½å†… APT æºä»¥åŠ é€Ÿä¾èµ–å®‰è£…ã€‚

### ğŸ’» æŠ€æœ¯å®ç°è¦ç‚¹
- é€‰æ‹©åˆé€‚åŸºç¡€é•œåƒï¼š
  - æ–¹æ¡ˆAï¼šä½¿ç”¨å®˜æ–¹ Playwright åŸºç¡€é•œåƒï¼ˆæ¨èï¼Œçœå»ä¾èµ–å®‰è£…ï¼‰ã€‚
  - æ–¹æ¡ˆBï¼šåœ¨ python-slim é•œåƒä¸­æ‰§è¡Œ `playwright install --with-deps` å¹¶å®‰è£…æ‰€éœ€ç³»ç»Ÿåº“ã€‚
- åœ¨é•œåƒæ„å»ºé˜¶æ®µæ‰§è¡Œï¼š
  - `python -m playwright install --with-deps chromium`ï¼ˆæˆ–å…¨éƒ¨æµè§ˆå™¨ï¼‰ã€‚
  - å®‰è£… curlï¼ˆä¾› HEALTHCHECK ä½¿ç”¨ï¼‰ã€‚
  - è‹¥åˆ‡æ¢é root ç”¨æˆ·ï¼Œç¡®ä¿æµè§ˆå™¨ä¸ç¼“å­˜ç›®å½•ï¼ˆå¦‚ /ms-playwrightã€/home/appuser/.cacheï¼‰æƒé™æ­£ç¡®ã€‚
  - é…ç½®å›½å†… APT æºä»¥åŠ é€Ÿä¾èµ–å®‰è£…ã€‚
- å¯é€‰ä¼˜åŒ–ï¼š
  - ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼ˆvenvï¼‰éš”ç¦» Python ä¾èµ–ï¼Œé¿å…ç³»ç»Ÿçº§å®‰è£…é™åˆ¶ã€‚
  - æ¸…ç†æ„å»ºç¼“å­˜ï¼Œå‡å°é•œåƒä½“ç§¯ã€‚

### âœ… çŠ¶æ€
- å·²å®Œæˆ

---

## ä»»åŠ¡5: API ä¸å¾®ä¿¡å…¬ä¼—å·å¯¹æ¥ï¼ˆæ–‡æ¡£ä¸æ­¥éª¤ï¼‰

**ç›®æ ‡**: ç”¨æˆ·åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸å®¢æœèŠå¤©çª—å£è¾“å…¥è¯åˆ¸ä»£ç ï¼ˆå¦‚â€œ000001â€ï¼‰ï¼Œç³»ç»Ÿè¿”å›è¯¥è‚¡ç¥¨è¿‘Nå¤©å…¬å‘Šæ€»ç»“ï¼ˆè°ƒç”¨ä»»åŠ¡2æ¥å£ï¼‰ã€‚

### ğŸ§­ æ¶æ„ä¸äº¤äº’æµç¨‹
1) ç”¨æˆ·åœ¨å…¬ä¼—å·å‘é€æ–‡æœ¬æ¶ˆæ¯ï¼ˆè¯åˆ¸ä»£ç ï¼‰
2) å¾®ä¿¡æœåŠ¡å™¨å°†æ¶ˆæ¯æ¨é€è‡³ä¸šåŠ¡æœåŠ¡çš„å›è°ƒURLï¼ˆPOSTï¼‰
3) å›è°ƒæœåŠ¡éªŒç­¾ã€è§£ææ–‡æœ¬ï¼Œè¯†åˆ«è‚¡ç¥¨ä»£ç 
4) è°ƒç”¨å†…éƒ¨APIï¼šPOST /api/v1/announcements/{stock_code}/sum è·å–æ€»ç»“
5) å°†æ€»ç»“ç»„ç»‡ä¸ºå…¬ä¼—å·æ–‡æœ¬æ¶ˆæ¯ï¼Œå›å¤ç»™ç”¨æˆ·

### ğŸªœ æ¥å…¥æ­¥éª¤ï¼ˆè¿è¥ä¸é…ç½®ï¼‰
1. å…¬ä¼—å·å‡†å¤‡
   - è´¦å·ç±»å‹ï¼šå»ºè®®æœåŠ¡å·ï¼ˆæˆ–ä½¿ç”¨â€œå…¬ä¼—å¹³å°æµ‹è¯•å·â€è¿›è¡Œè”è°ƒï¼‰
   - è·å– AppIDã€AppSecret
   - é…ç½®æœåŠ¡å™¨é…ç½®ï¼ˆå¼€å‘è®¾ç½®ï¼‰ï¼š
     - URLï¼šä¾‹å¦‚ https://your-domain/wechat/callback
     - Tokenï¼šè‡ªå®šä¹‰å­—ç¬¦ä¸²ï¼Œç”¨äºç­¾åæ ¡éªŒ
     - EncodingAESKeyï¼šå¹³å°ç”Ÿæˆï¼Œç”¨äºæ¶ˆæ¯åŠ è§£å¯†
     - æ¶ˆæ¯åŠ è§£å¯†æ–¹å¼ï¼šå»ºè®®â€œå…¼å®¹æ¨¡å¼â€æˆ–â€œå®‰å…¨æ¨¡å¼â€
2. åŸŸåä¸ç½‘ç»œ
   - æä¾›å…¬ç½‘å¯è®¿é—®çš„ HTTPS åŸŸåï¼Œè¯ä¹¦æœ‰æ•ˆ
   - å¯é€‰ï¼šåœ¨ç½‘å…³/åå‘ä»£ç†å¤„åšé™æµä¸ç™½åå•
3. å›è°ƒURLè”è°ƒï¼ˆä»…æµç¨‹è¯´æ˜ï¼Œä¸å†™ä»£ç ï¼‰
   - GET /wechat/callbackï¼šå¾®ä¿¡æœåŠ¡å™¨ç”¨äºâ€œæ¥å…¥æ ¡éªŒâ€
     - æ ¡éªŒå‚æ•°ï¼šsignatureã€timestampã€nonceã€echostr
     - æœåŠ¡ç«¯æŒ‰è§„åˆ™å¯¹ tokenã€timestampã€nonce åš SHA1ï¼ŒåŒ¹é… signatureï¼Œé€šè¿‡ååŸæ ·è¿”å› echostr
   - POST /wechat/callbackï¼šæ¥æ”¶ç”¨æˆ·æ¶ˆæ¯
     - æŒ‰å…¬ä¼—å·é…ç½®çš„åŠ å¯†æ¨¡å¼è§£æ XML æ¶ˆæ¶ˆæ¯ä½“ï¼Œæå– MsgType=textã€Content
     - ä¸šåŠ¡å¤„ç†åè¿”å›è¢«åŠ¨å›å¤ XMLï¼ˆæˆ–ä½¿ç”¨å®¢æœæ¶ˆæ¯æ¥å£ä¸»åŠ¨æ¨é€ï¼‰

### ğŸ”¤ æ¶ˆæ¯ä¸è§£æè§„èŒƒï¼ˆæ–‡æœ¬ï¼‰
- è‚¡ç¥¨ä»£ç è¯†åˆ«ï¼š
  - æ”¯æŒ 6 ä½æ•°å­—ï¼ˆå¦‚ 000001ï¼‰
  - å¯æ‰©å±•æ”¯æŒå¸¦äº¤æ˜“æ‰€å‰ç¼€ï¼ˆå¦‚ SZ000001/SH600000ï¼‰ï¼Œå†…éƒ¨ç»Ÿä¸€åˆ° 6 ä½ä»£ç 
- éæ³•è¾“å…¥å¤„ç†ï¼šè¿”å›å¼•å¯¼æç¤ºï¼Œä¾‹å¦‚â€œè¯·å‘é€6ä½Aè‚¡ä»£ç ï¼Œå¦‚ 000001â€

### ğŸ”— APIæ˜ å°„ï¼ˆå†…éƒ¨è°ƒç”¨ï¼‰
- æ±‡æ€»æ¥å£ï¼šPOST /api/v1/announcements/{stock_code}/sum
- æˆåŠŸå“åº”å…³é”®å­—æ®µï¼šcontentï¼ˆæœ€ç»ˆæ±‡æ€»æ–‡æœ¬ï¼‰ã€word_count
- è¶…é•¿æ–‡æœ¬åˆ†æ®µï¼šå…¬ä¼—å·å•æ¡æ–‡æœ¬ä¸Šé™çº¦2k~4kå­—ç¬¦ï¼Œè¶…è¿‡éœ€æ‹†åˆ†å¤šæ¡å›å¤

### ğŸ§± å®‰å…¨ä¸åˆè§„
- å¿…é¡»è¿›è¡Œç­¾åæ ¡éªŒï¼ˆsignatureï¼‰ä¸é‡æ”¾é˜²æŠ¤ï¼ˆtimestamp/nonceï¼‰
- å®‰å…¨/å…¼å®¹æ¨¡å¼ä¸‹è¿›è¡Œ AES è§£å¯†ä¸åŠ å¯†å›å¤
- å¹‚ç­‰ï¼šä¾æ® FromUserName + MsgId æˆ– CreateTime åšå»é‡å¤„ç†ï¼Œé¿å…é‡å¤è°ƒç”¨
- éšç§ä¸åˆè§„ï¼šä¸å­˜å‚¨ç”¨æˆ·æ•æ„Ÿæ•°æ®ï¼Œä»…è®°å½•å¿…è¦å®¡è®¡æ—¥å¿—

### ğŸš¦ é¢‘æ§ä¸ç¼“å­˜å»ºè®®
- é¢‘æ§ï¼šå¯¹åŒä¸€ç”¨æˆ·/åŒä¸€è‚¡ç¥¨åœ¨çŸ­æ—¶é—´å†…é™æµï¼ˆå¦‚ 60s å†…æœ€å¤š1æ¬¡ï¼‰
- ç¼“å­˜ï¼š
  - å¯¹ sum ç»“æœåšçŸ­æ—¶ç¼“å­˜ï¼ˆå¦‚ 10~30 åˆ†é’Ÿï¼‰ï¼Œå‘½ä¸­åˆ™ç›´æ¥è¿”å›
  - å¤±è´¥é‡è¯•ä¸é™çº§ï¼šè¿”å›â€œå½“å‰æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•â€

### ğŸš€ éƒ¨ç½²ä¸è¿ç»´
- æœåŠ¡éœ€è¦ï¼š
  - æš´éœ² /wechat/callbackï¼ˆ80/443ï¼‰
  - å†…éƒ¨å¯è®¿é—®æœ¬é¡¹ç›® APIï¼ˆåŒä¸€å®¹å™¨æˆ–åŒä¸€ç½‘ç»œå‡å¯ï¼‰
- æ—¥å¿—ä¸ç›‘æ§ï¼š
  - è®°å½•éªŒç­¾å¤±è´¥ã€è§£æå¤±è´¥ã€è°ƒç”¨å†…éƒ¨APIè¶…æ—¶ç­‰å…³é”®äº‹ä»¶
  - æŒ‡æ ‡ï¼šæˆåŠŸç‡ã€å¹³å‡å»¶è¿Ÿã€è¶…æ—¶ç‡ã€è°ƒç”¨é…é¢ï¼ˆLLM/Playwrightï¼‰

### ğŸ§ª éªŒæ”¶æ¸…å•
- [ ] æœåŠ¡å™¨é…ç½®æ ¡éªŒé€šè¿‡ï¼ˆGET éªŒç­¾æˆåŠŸï¼‰
- [ ] æ–‡æœ¬æ¶ˆæ¯â€œ000001â€å¯è¿”å›æ€»ç»“
- [ ] å¼‚å¸¸è¾“å…¥æœ‰æ­£ç¡®çš„å¼•å¯¼æ–‡æ¡ˆ
- [ ] è¶…é•¿å†…å®¹ä¼šæ™ºèƒ½åˆ†æ®µ
- [ ] é™æµä¸ç¼“å­˜ç­–ç•¥ç”Ÿæ•ˆ
- [ ] å®‰å…¨æ¨¡å¼æ”¶å‘æ¶ˆæ¯åŠ è§£å¯†æ­£ç¡®

### ğŸ“Š å½“å‰çŠ¶æ€
âŒ **å¾…å¼€å‘** - æœ¬ä»»åŠ¡ä»…å½¢æˆå®æ–½æ–‡æ¡£ä¸æµç¨‹ï¼Œå°šæœªç¼–å†™å›è°ƒæ§åˆ¶å™¨ä¸æ¶ˆæ¯ç¼–è§£ç ä»£ç ã€‚

---

## ä»»åŠ¡6: ä½¿ç”¨ Docker Compose éƒ¨ç½² Nginx ä¸åº”ç”¨æœåŠ¡ï¼ˆä»…æ–‡æ¡£ï¼Œå…ˆä¸å®ç°ä»£ç ï¼‰

**ç›®æ ‡**: é€šè¿‡ docker compose åŒæ—¶éƒ¨ç½²åå‘ä»£ç†ï¼ˆNginxï¼Œæ”¯æŒ SSLï¼‰ä¸æœ¬æœåŠ¡å®¹å™¨ï¼Œæä¾›å¯¹å¤– HTTPS è®¿é—®ä¸åˆ°åº”ç”¨çš„åå‘ä»£ç†ã€‚

### ğŸ“ æ–‡ä»¶ä¸ç›®å½•è§„åˆ’ï¼ˆé¢„ç•™ï¼‰
- `docker-compose.yml`ï¼ˆæˆ– `compose.yaml`ï¼‰ï¼šå®šä¹‰ nginx ä¸ app ä¸¤ä¸ªæœåŠ¡
- `deploy/nginx/nginx.conf`ï¼šNginx ä¸»é…ç½®ï¼ˆå« HTTPS ä¸åå‘ä»£ç†ï¼‰
- `certs/`ï¼šå­˜æ”¾ SSL è¯ä¹¦ä¸ç§é’¥ï¼ˆé¢„ç•™ï¼Œä¸éšä»“åº“æäº¤ï¼‰
  - `fullchain.pem`ï¼ˆæˆ– `server.crt`ï¼‰
  - `privkey.pem`ï¼ˆæˆ– `server.key`ï¼‰

### ğŸ§© Compose è®¾è®¡ï¼ˆé¢„æ¡ˆï¼‰
- ç½‘ç»œï¼šå•ä¸€è‡ªå®šä¹‰ç½‘ç»œ `webnet`ï¼Œnginx ä¸ app äº’é€š
- æœåŠ¡ï¼š
  - appï¼š
    - åŸºäºå½“å‰é¡¹ç›® Dockerfile æ„å»ºæˆ–ä½¿ç”¨å·²å‘å¸ƒé•œåƒ
    - æš´éœ² 8000 ç«¯å£ï¼ˆä»…å®¹å™¨å†…å¯è§ï¼‰ï¼Œå¥åº·æ£€æŸ¥æŒ‡å‘ `/health`
  - nginxï¼š
    - ä¾èµ– app å¯åŠ¨ï¼Œæ˜ å°„ä¸»æœº 80ã€443 ç«¯å£
    - åªè¯»æŒ‚è½½ `deploy/nginx/nginx.conf -> /etc/nginx/nginx.conf`
    - åªè¯»æŒ‚è½½ `certs -> /etc/nginx/certs`ï¼ˆè¯ä¹¦ç›®å½•ï¼Œé¢„ç•™ï¼‰

### âš™ï¸ Nginx é…ç½®è¦ç‚¹ï¼ˆnginx.conf é¢„ç•™è§„èŒƒï¼‰
- upstream `app` æŒ‡å‘ `app:8000`
- HTTP 80ï¼šå…¨é‡ 301 è·³è½¬åˆ° HTTPS
- HTTPS 443ï¼š
  - `ssl_certificate /etc/nginx/certs/fullchain.pem;`
  - `ssl_certificate_key /etc/nginx/certs/privkey.pem;`
  - å¼€å¯ `http2`ã€åˆç†çš„ `ssl_protocols` ä¸ `ssl_ciphers`
  - åå‘ä»£ç†åˆ° `http://app`ï¼Œä¼ é€’å¤´éƒ¨ï¼š`Host`ã€`X-Forwarded-For`ã€`X-Forwarded-Proto`
  - WebSocket æ”¯æŒï¼š`Upgrade` ä¸ `Connection` å¤´

### ğŸ§ª éªŒæ”¶æ¸…å•
- [ ] `docker compose up -d` åä¸¤ä¸ªå®¹å™¨å‡ä¸º healthy
- [ ] è®¿é—® `http://` è‡ªåŠ¨è·³è½¬ `https://`
- [ ] è¯ä¹¦æŒ‚è½½å HTTPS æ­£å¸¸æ¡æ‰‹
- [ ] `https://<domain>/health` ç» Nginx åä»£å¯è¾¾ app å¥åº·æ£€æŸ¥

### ğŸ“Š å½“å‰çŠ¶æ€
âŒ **å¾…å¼€å‘** - ä»…å®Œå–„æ–‡æ¡£ä¸ç›®å½•è§„åˆ’ï¼Œæš‚ä¸æäº¤ `nginx.conf` ä¸ `docker-compose.yml` å…·ä½“å®ç°ã€‚
