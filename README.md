# è‚¡ç¥¨å…¬å‘Šä¿¡æ¯APIæœåŠ¡

åŸºäº FastAPI + AKShare å¼€å‘çš„è‚¡ç¥¨å…¬å‘Šä¿¡æ¯APIæœåŠ¡ï¼Œä¸“æ³¨äºæä¾›Aè‚¡å¸‚åœºçš„å…¬å‘Šæ•°æ®æŸ¥è¯¢å’ŒAIæ™ºèƒ½æ€»ç»“åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **å…¬å‘Šæ•°æ®è·å–**ï¼šä½¿ç”¨ AKShare çš„ `stock_notice_report` æ¥å£è·å–è‚¡ç¥¨å…¬å‘Š
- **æ—¥çº§æ•°æ®**ï¼šæ”¯æŒæŸ¥è¯¢æŒ‡å®šæ—¥æœŸçš„è‚¡ç¥¨å…¬å‘Šä¿¡æ¯
- **å®æ—¶è·å–**ï¼šæ— æŒä¹…åŒ–å­˜å‚¨ï¼Œæ¯æ¬¡è¯·æ±‚å®æ—¶è·å–æœ€æ–°æ•°æ®
- **AIæ™ºèƒ½æ€»ç»“**ï¼šé›†æˆç™¾ç‚¼å¤§æ¨¡å‹ Qwen3 è¿›è¡Œå…¬å‘Šæ™ºèƒ½æ€»ç»“ï¼ˆé¢„ç•™æ¥å£ï¼‰
- **Webhookæ”¯æŒ**ï¼šä¸º n8n å·¥ä½œæµä¼˜åŒ–çš„ Webhook æ¥å£
- **RESTful API**ï¼šæ ‡å‡†çš„ REST é£æ ¼æ¥å£è®¾è®¡

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼šFastAPI
- **æ•°æ®æº**ï¼šAKShare
- **AIæ¨¡å‹**ï¼šç™¾ç‚¼å¤§æ¨¡å‹ Qwen3ï¼ˆé¢„ç•™ï¼‰
- **è¯­è¨€**ï¼šPython 3.8+

## ğŸ“¦ å®‰è£…ä¸è¿è¡Œ

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- pip

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
bash start.sh
```

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t stock-announcement-api .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 stock-announcement-api

# æˆ–ä½¿ç”¨ docker-compose
docker-compose up -d
```

## ğŸ“š APIæ¥å£æ–‡æ¡£

### æ ¸å¿ƒæ¥å£

#### 1. è·å–è‚¡ç¥¨å…¬å‘Šåˆ—è¡¨
```http
GET /api/v1/announcements/{stock_code}
```

**å‚æ•°**ï¼š
- `stock_code`: è‚¡ç¥¨ä»£ç ï¼ˆå¿…å¡«ï¼‰

**è¯´æ˜**ï¼š
- ä½¿ç”¨ AKShare çš„ `stock_notice_report` æ¥å£è·å–æ•°æ®
- æ•°æ®æ¥æºï¼šå„å¤§è¯åˆ¸äº¤æ˜“æ‰€å®˜æ–¹å…¬å‘Š
- è‡ªåŠ¨è·å–è¿‡å»10å¤©çš„å…¬å‘Šä¿¡æ¯
- è¿”å›å…¬å‘Šè¯¦æƒ…é“¾æ¥åˆ—è¡¨

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "success": true,
    "data": {
        "announcements": [
            {
                "stock_code": "000001",
                "stock_name": "å¹³å®‰é“¶è¡Œ",
                "title": "å…³äºå¬å¼€2024å¹´ç¬¬ä¸‰æ¬¡ä¸´æ—¶è‚¡ä¸œå¤§ä¼šçš„é€šçŸ¥",
                "category": "ä¸´æ—¶è‚¡ä¸œå¤§ä¼š",
                "publish_date": "2024-09-17",
                "url": "http://static.cninfo.com.cn/finalpage/..."
            }
        ],
        "total": 1,
        "page": 1,
        "size": 20
    },
    "message": "è·å–å…¬å‘ŠæˆåŠŸ"
}
```

#### 2. AIæ™ºèƒ½æ€»ç»“å…¬å‘Š
```http
POST /api/v1/announcements/summarize
```

**è¯·æ±‚ä½“**ï¼š
```json
{
    "stock_code": "000001"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "success": true,
    "data": {
        "summary": "ã€AIæ€»ç»“åŠŸèƒ½é¢„ç•™ã€‘é’ˆå¯¹è‚¡ç¥¨ï¼š000001çš„å…¬å‘Šæ€»ç»“",
        "key_points": [
            "â€¢ å…³é”®è¦ç‚¹1ï¼ˆå¾…AIç”Ÿæˆï¼‰",
            "â€¢ å…³é”®è¦ç‚¹2ï¼ˆå¾…AIç”Ÿæˆï¼‰",
            "â€¢ å…³é”®è¦ç‚¹3ï¼ˆå¾…AIç”Ÿæˆï¼‰"
        ],
        "impact_analysis": {
            "positive_impact": "æ­£é¢å½±å“åˆ†æï¼ˆå¾…AIç”Ÿæˆï¼‰",
            "negative_impact": "è´Ÿé¢å½±å“åˆ†æï¼ˆå¾…AIç”Ÿæˆï¼‰",
            "neutral_impact": "ä¸­æ€§å½±å“åˆ†æï¼ˆå¾…AIç”Ÿæˆï¼‰"
        },
        "investment_suggestion": "æŠ•èµ„å»ºè®®ï¼ˆå¾…AIç”Ÿæˆï¼Œ500å­—å†…ï¼‰",
        "word_count": 0,
        "model_info": {
            "model": "qwen3",
            "provider": "ç™¾ç‚¼å¤§æ¨¡å‹",
            "status": "æ¥å£é¢„ç•™"
        }
    },
    "message": "AIæ€»ç»“å®Œæˆï¼ˆå½“å‰ä¸ºé¢„ç•™æ¥å£ï¼‰"
}
```

#### 3. Webhookæ¥å£ï¼ˆn8nä¸“ç”¨ï¼‰
```http
POST /api/v1/webhook/announcements
```

**è¯·æ±‚ä½“**ï¼š
```json
{
    "stock_codes": ["000001", "000002"],
    "date": "2024-09-17"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
    "success": true,
    "data": [
        {
            "stock_code": "000001",
            "announcements": {
                "announcements": [...],
                "total": 5,
                "page": 1,
                "size": 50
            }
        }
    ],
    "message": "Webhookå¤„ç†æˆåŠŸï¼Œå…±å¤„ç†2åªè‚¡ç¥¨"
}
```

### ç³»ç»Ÿæ¥å£

#### å¥åº·æ£€æŸ¥
```http
GET /health
```

#### ç³»ç»Ÿä¿¡æ¯
```http
GET /api/v1/system/info
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
# æœåŠ¡é…ç½®
APP_NAME=è‚¡ç¥¨å…¬å‘ŠAPIæœåŠ¡
APP_VERSION=1.0.0
DEBUG=true

# APIé…ç½®
API_V1_STR=/api/v1

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
```

## ğŸ“– æ•°æ®æºè¯´æ˜

### AKShare stock_notice_report æ¥å£

æœ¬æœåŠ¡ä½¿ç”¨ AKShare çš„ `stock_notice_report` æ¥å£è·å–è‚¡ç¥¨å…¬å‘Šæ•°æ®ï¼š

- **æ¥å£åç§°**ï¼š`ak.stock_notice_report(symbol="è´¢åŠ¡æŠ¥å‘Š", date="20240917")`
- **æ•°æ®æ¥æº**ï¼šå·¨æ½®èµ„è®¯ç½‘
- **æ›´æ–°é¢‘ç‡**ï¼šå®æ—¶æ›´æ–°
- **æ•°æ®è¦†ç›–**ï¼šæ²ªæ·±Aè‚¡å¸‚åœº

**è¿”å›å­—æ®µè¯´æ˜**ï¼š
- `ä»£ç `: è‚¡ç¥¨ä»£ç 
- `åç§°`: è‚¡ç¥¨ç®€ç§°
- `å…¬å‘Šæ ‡é¢˜`: å…¬å‘Šæ ‡é¢˜
- `å…¬å‘Šç±»å‹`: å…¬å‘Šåˆ†ç±»
- `å…¬å‘Šæ—¥æœŸ`: å‘å¸ƒæ—¥æœŸ
- `ç½‘å€`: å…¬å‘Šè¯¦æƒ…é“¾æ¥

## ğŸ”„ ä½¿ç”¨åœºæ™¯

1. **è´¢ç»åª’ä½“**ï¼šè‡ªåŠ¨è·å–å’Œåˆ†æè‚¡ç¥¨å…¬å‘Š
2. **é‡åŒ–æŠ•èµ„**ï¼šå…¬å‘Šæ•°æ®é©±åŠ¨çš„æŠ•èµ„ç­–ç•¥
3. **é£é™©ç›‘æ§**ï¼šé‡è¦å…¬å‘Šçš„å®æ—¶ç›‘æ§
4. **æ•°æ®åˆ†æ**ï¼šè‚¡ç¥¨å…¬å‘Šçš„ç»Ÿè®¡åˆ†æ
5. **å·¥ä½œæµè‡ªåŠ¨åŒ–**ï¼šç»“åˆ n8n æ„å»ºè‡ªåŠ¨åŒ–æ•°æ®å¤„ç†æµç¨‹

## ğŸ¤ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
quoted-com-insight/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½®å’Œå¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ models.py       # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ routers/        # APIè·¯ç”±
â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â””â”€â”€ main.py         # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ requirements.txt    # ä¾èµ–åŒ…
â”œâ”€â”€ Dockerfile         # Dockeré…ç½®
â””â”€â”€ README.md          # é¡¹ç›®æ–‡æ¡£
```

### æœ¬åœ°å¼€å‘

1. å…‹éš†é¡¹ç›®ï¼š
```bash
git clone <repository-url>
cd quoted-com-insight
```

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows
```

3. å®‰è£…ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
```bash
uvicorn app.main:app --reload
```

5. è®¿é—® API æ–‡æ¡£ï¼š
   - Swagger UI: http://localhost:8000/docs
   - ReDoc: http://localhost:8000/redoc

### æµ‹è¯•
```bash
# è¿è¡Œæµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_akshare_api.py
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-09-17)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒè‚¡ç¥¨å…¬å‘Šæ•°æ®è·å–
- é›†æˆ AKShare stock_notice_report æ¥å£
- æä¾› Webhook æ¥å£æ”¯æŒ n8n
- é¢„ç•™ AI æ™ºèƒ½æ€»ç»“åŠŸèƒ½

## ğŸ”— ç›¸å…³é“¾æ¥

- [AKShare æ–‡æ¡£](https://akshare.akfamily.xyz/)
- [FastAPI å®˜ç½‘](https://fastapi.tiangolo.com/)
- [ç™¾ç‚¼å¤§æ¨¡å‹](https://bailian.aliyun.com/)

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™‹â€â™‚ï¸ è”ç³»æˆ‘ä»¬

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚
